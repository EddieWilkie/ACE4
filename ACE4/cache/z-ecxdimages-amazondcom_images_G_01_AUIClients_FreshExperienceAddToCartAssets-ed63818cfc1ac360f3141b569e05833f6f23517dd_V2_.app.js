(function(g,h,f){g.execute(function(){g.when("A","jQuery","a-button").register("fx-atfc-button-utils",function(a,b){var c=!1;return{hideButtonAndRenderSpinner:function(a){var d=a.$currentTarget.find(".a-button");d&&d.length&&(c=!0,a="atfc-spinner-"+a.data.asin,d.wrap('<div id="'+a+'" class="atfc-spinner"></div>'),b("#"+a).css({width:d.outerWidth()+"px"}),b("#"+a).css({height:d.outerHeight()+"px"}),d.css("visibility","hidden"))},showButtonAndRemoveSpinner:function(a){var d=a.$currentTarget.find(".a-button"),a=b("#atfc-spinner-"+a.data.asin);d&&d.length&&a&&a.length&&(c=!1,d.css("visibility","visible"),d.unwrap())},shouldDisableButtonClicks:function(){return c}}});g.when("A","jQuery","a-modal","afx-uatc-proxy","afx-get-cart-count","fx-atfc-button-utils","afx-csm-metrics-utils","ready").register("fresh-add-to-cart",function(a,b,c,e,d,w,r){var i,m,o,p;g.when("EWC").execute("add-to-cart-refresh",function(a){p=a});g.when("nav.getFlyout").execute(function(a){a("ewc")});var j={"itemPrice:priceUnavailable:1":"PRICE_UNAVAILABLE","itemDeleted:itemCountOverflow:6":"QUANTITY_OVERFLOW"};i="afxAddToFreshCartSuccessfulAddCount";m="afxAddToFreshCartErrorModalCount";o="afxAddToFreshCartUnexpectedErrorCount";return{addToFreshCart:function(l){function q(d,e){var f=e||{},g=d.data.sessionID;f.title=d.data.title;f.asin=d.data.asin;f.offerListingID=d.data.offerListingID;f.sessionID=g;f=b.param(f);f=c.create(d.$currentTarget,{name:"fresh-add-to-cart-modal",url:"/afx/cart/reservation_conflict?"+f});f.show();b("#a-popover-lgtbox").css("position","fixed");f.$container.css("position","fixed");a.on("a:popover:afterHide:fresh-add-to-cart-modal",function(a){x(g);c.remove(a.popover)})}function n(a){return a.filter(function(a){return a.statusKey in j})}function u(a,b,c){c+=" returned by UATC is not an array";g.log(c,"Error",b);q(a);l.error(a,"","",c)}function k(a,c){var d=a.data.asin,h=a.data.offerListingID,v=a.data.sessionID,k=a.data.reftag;b.each({title:a.data.title,asin:d,offerListingID:h,sessionID:v},function(b,c){c===f&&(g.log("fresh-add-to-cart required parameter is missing","Error",b),q(a),l.error(a,void 0,void 0,void 0))});e({asin:d,offerListingID:h,sessionID:v,reftag:k,success:function(d){var e;!d||!d.isOK?e=!0:(e=d.extraErrorInfos)&&e.constructor===Array&&e.length>0?e=!0:(e=(e=d.statusList)&&e.constructor===Array&&e.length>0?(e=n(e))&&e.length>0:!1,e=e?!0:!1);if(e)if(r.increment(m),d)if(d.isOK)if(e=d.extraErrorInfos,d=d.statusList,e&&e.constructor!==Array)u(a,e,"extraErrorInfos");else if(e.length>0){if(e&&!(e.length<=0))d=e[0],d.statusCode==="ADDRESS_NOT_SELECTED"?(d=b.param({asin:a.data.asin,offerListingID:a.data.offerListingID,quantity:1,redirectURL:document.location.href,ref:"afx_atfc_noaddress"}),document.location.href="/afx/nc/chooseaddress?"+d):q(a,{reasonCode:d.itemStatusCode,quantityAdded:d.availableQuantity,quantityRequested:d.requestedQuantity})}else d&&d.constructor!==Array?u(a,d,"statusList"):d.length>0&&d&&!(d.length<=0)&&(d=n(d))&&d.length>0&&q(a,{reasonCode:j[d[0].statusKey]});else q(a),l.error(a,"","","isOK returned by UATC is false");else q(a),l.error(a,"","","No response from UATC");else r.increment(i),c(d,v);w.showButtonAndRemoveSpinner(a)},error:function(b,c,d){r.increment(o);q(a);l.error(a,b,c,d);w.showButtonAndRemoveSpinner(a)}})}function t(b){var c={token:(a.state("baseWidgetState")||{}).csrfToken};a.post("/afx/slotselection/cancel",{timeout:5E3,params:c,success:function(){k(b,function(){location.reload()})},error:function(){g.log("Failed to clear reservation")}})}function s(a){d({sessionID:a,success:function(a){a&&a.isOK&&a.total&&v(a.total.numActiveItem)},error:function(){g.log("Failed to get cart count","Error",a)}})}function v(a){g.when("nav.setCartCount").execute(function(b){b(a)});g.when("mash").execute(function(b){b.cart&&typeof b.cart.didUpdate==="function"&&b.cart.didUpdate({newCartQuantity:a})})}function x(a){p!==f&&typeof p.refresh==="function"?p.refresh():s(a)}a.declarative("fresh-clear-slot","click",function(a){t(a)});a.declarative("fresh-add-to-cart","click",function(a){!w.shouldDisableButtonClicks()&&!a.$currentTarget.find("input").is(":disabled")&&(w.hideButtonAndRenderSpinner(a),h.amazon&&h.amazon.cordova&&h.amazon.cordova.notification&&h.amazon.cordova.notification.vibrate&&h.amazon.cordova.notification.vibrate(50),r.increment("afxAddToFreshCartCount"),k(a,function(b,c){x(c);l.success(a,b)}))})}}});g.when("A").register("afx-uatc-proxy",function(a){return function(b){var c="/gp/add-to-cart/json";b.reftag!==f&&(c+="/ref="+b.reftag);a.post(c,{timeout:5E3,params:{"session-id":b.sessionID,clientName:"SharedFreshHandler",nextPage:"cartitems",ASIN:b.asin,offerListingID:b.offerListingID,useUber:"1",source:"Fresh",ruleSet:"FreshGet"},success:b.success,error:b.error})}});g.when("A").register("afx-get-cart-count",function(a){return function(b){a.post("/gp/api/cart/1.0/get-cart-count.json",{timeout:5E3,params:{sessionID:b.sessionID,clientName:"SharedFreshHandler"},success:b.success,error:b.error})}});g.register("afx-csm-metrics-utils",function(){return{startWidgetTimer:function(a){h.uet&&a&&h.uet("bb",a,{wb:1})},endWidgetTimer:function(a){h.uex&&a&&h.uex("ld",a,{wb:1})},setWidgetClickTimestamp:function(a){h.ue&&h.uet&&a&&h.uet("tc",a,{wb:1})},setWidgetTimestamp:function(a,b){h.ue&&h.uet&&a&&b&&h.uet(a,b,{wb:1})},increment:function(a){h.ue&&h.ue.count&&a&&h.ue.count(a,(h.ue.count(a)||0)+1)},setCount:function(a,b){h.ue&&h.ue.count&&a&&b&&h.ue.count(a,b)},sendWidgetMetrics:function(a){h.ue&&h.uex&&a&&h.uex("ld",a,{wb:1})}}})})})(function(){var g=window.AmazonUIPageJS||window.P,h=g._namespace||g.attributeErrors;return h?h("FreshExperienceAddToCartAssets"):g}(),window);